<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loan Approval Predictor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; margin-bottom: 30px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        input:focus, select:focus { outline: none; border-color: #007bff; }
        .submit-btn { background: #007bff; color: white; padding: 12px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 20px; }
        .submit-btn:hover { background: #0056b3; }
        .result { margin-top: 30px; padding: 20px; border-radius: 5px; display: none; }
        .approved { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .rejected { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .loading { text-align: center; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Loan Approval Predictor</h1>
        <form id="loanForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="annual_income">Annual Income ($)</label>
                    <input type="number" id="annual_income" name="annual_income" required>
                </div>
                <div class="form-group">
                    <label for="loan_amount">Loan Amount ($)</label>
                    <input type="number" id="loan_amount" name="loan_amount" required>
                </div>
                <div class="form-group">
                    <label for="dti">Debt-to-Income Ratio</label>
                    <input type="number" id="dti" name="dti" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="int_rate">Interest Rate</label>
                    <input type="number" id="int_rate" name="int_rate" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="installment">Monthly Installment ($)</label>
                    <input type="number" id="installment" name="installment" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="total_acc">Total Accounts</label>
                    <input type="number" id="total_acc" name="total_acc" required>
                </div>
                <div class="form-group">
                    <label for="grade">Grade</label>
                    <select id="grade" name="grade" required>
                        <option value="">Select Grade</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="G">G</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="sub_grade">Sub Grade</label>
                    <input type="text" id="sub_grade" name="sub_grade" placeholder="e.g., B2" required>
                </div>
                <div class="form-group">
                    <label for="emp_length">Employment Length</label>
                    <select id="emp_length" name="emp_length" required>
                        <option value="">Select Length</option>
                        <option value="< 1 year">< 1 year</option>
                        <option value="1 year">1 year</option>
                        <option value="2 years">2 years</option>
                        <option value="3 years">3 years</option>
                        <option value="4 years">4 years</option>
                        <option value="5 years">5 years</option>
                        <option value="6 years">6 years</option>
                        <option value="7 years">7 years</option>
                        <option value="8 years">8 years</option>
                        <option value="9 years">9 years</option>
                        <option value="10+ years">10+ years</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="home_ownership">Home Ownership</label>
                    <select id="home_ownership" name="home_ownership" required>
                        <option value="">Select Ownership</option>
                        <option value="RENT">Rent</option>
                        <option value="OWN">Own</option>
                        <option value="MORTGAGE">Mortgage</option>
                        <option value="OTHER">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="verification_status">Verification Status</label>
                    <select id="verification_status" name="verification_status" required>
                        <option value="">Select Status</option>
                        <option value="Verified">Verified</option>
                        <option value="Source Verified">Source Verified</option>
                        <option value="Not Verified">Not Verified</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="purpose">Purpose</label>
                    <select id="purpose" name="purpose" required>
                        <option value="">Select Purpose</option>
                        <option value="debt_consolidation">Debt Consolidation</option>
                        <option value="credit_card">Credit Card</option>
                        <option value="home_improvement">Home Improvement</option>
                        <option value="major_purchase">Major Purchase</option>
                        <option value="car">Car</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="term">Term</label>
                    <select id="term" name="term" required>
                        <option value="">Select Term</option>
                        <option value="36 months">36 months</option>
                        <option value="60 months">60 months</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="address_state">State</label>
                    <input type="text" id="address_state" name="address_state" placeholder="e.g., CA" maxlength="2" required>
                </div>
            </div>
            <button type="submit" class="submit-btn">Predict Loan Approval</button>
        </form>

        <div id="result" class="result">
            <div id="resultContent"></div>
        </div>
    </div>

    <script>
        document.getElementById('loanForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            // Show loading
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultContent.innerHTML = '<div class="loading">Processing your loan application...</div>';
            
            // Collect form data
            const formData = new FormData(this);
            const data = {};
            for (let [key, value] of formData.entries()) {
                if (['annual_income', 'loan_amount', 'dti', 'int_rate', 'installment', 'total_acc'].includes(key)) {
                    data[key] = parseFloat(value);
                } else {
                    data[key] = value;
                }
            }
            
            try {
                const response = await fetch('http://localhost:8000/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    const isApproved = result.loan_decision === 'APPROVED';
                    resultDiv.className = `result ${isApproved ? 'approved' : 'rejected'}`;
                    
                    resultContent.innerHTML = `
                        <h3>${result.loan_decision}</h3>
                        <p><strong>Risk Level:</strong> ${result.risk_level}</p>
                        <p><strong>Probability of Good Loan:</strong> ${(result.probability_good_loan * 100).toFixed(1)}%</p>
                        <p><strong>Probability of Bad Loan:</strong> ${(result.probability_bad_loan * 100).toFixed(1)}%</p>
                    `;
                } else {
                    throw new Error(result.detail || 'Prediction failed');
                }
            } catch (error) {
                resultDiv.className = 'result rejected';
                resultContent.innerHTML = `<h3>Error</h3><p>${error.message}</p>`;
            }
        });
    </script>
</body>
</html>